/**
 * @title elq.js
 * @overview Parses CSS for element queries, supports them in JavaScript
 * @copyright (c) 2014
 * @license CC BY (http://creativecommons.org/licenses/by/4.0/)
 * @author Art Lawry
*/
window.elq=function(a,b){"use strict";var c,d,e=100,f=0,g={},h={},i=new RegExp("\\s*([^,}]+)\\:media\\(((?:(?:(?:\\s*not)?\\s*(?:\\([^)]+\\))(?:\\s*and\\s*(?:\\([^)]+\\)))*)(?:\\s*,(?:\\s*not)\\s*(?:\\([^)]+\\))(?:\\s*and\\s*(?:\\([^)]+\\)))*)*|[^()]+))\\)","g"),j=new RegExp("([^\\\\])(['\"])(.*?[^\\\\])\\2","g"),k={},l=function(){var a,c,e,f=Object.keys(h),g=f.length;for(e=function(a,c,e,f,g){var i,j,k=h[a],l=Object.keys(k),m=l.length,n=[],o=[];for(j=0;m>j;j+=1)i=k[l[j]](f,g,e,c,d),n=n.concat(i.added),o=o.concat(i.removed);if(n.length||o.length){var p=b.createEvent("CustomEvent");p.initCustomEvent("elq-change",!0,!0,{addedClasses:n,removedClasses:o,contextWidth:f,contextHeight:g}),e.dispatchEvent(p)}},c=function(a){var c,d,f,g,h,i,j=b.querySelectorAll(a),k=j.length;for(c=0;k>c;c+=1)d=j[c],f=d.parentNode,g=b.defaultView.getComputedStyle(f,null).getPropertyValue("fontSize"),h=f.clientWidth+2*(parseInt(f.style.padding,10)||0)+(parseInt(f.style.paddingLeft,10)||0)+(parseInt(f.style.paddingRight,10)||0),i=f.clientHeight+2*(parseInt(f.style.padding,10)||0)+(parseInt(f.style.paddingTop,10)||0)+(parseInt(f.style.paddingBottom,10)||0),e(a,g,d,h,i)},a=0;g>a;a+=1)c(f[a]);return g?!0:!1};return a._revealed=k,k.fetchExternalCSS=function(a){var c,d,e=!1,h=a.getAttribute("href"),i=a.getAttribute("media")||"";return g[h+i]?f-=1:(e=!0,c=b.createElement("style"),d=new XMLHttpRequest,i&&c.setAttribute("media",i),c.setAttribute("href",h),c.className="elq-fetched",a.parentNode.insertBefore(c,a.nextSibling),g[h+i]=!0,d.onreadystatechange=function(){4===d.readyState&&(200===d.status?c.innerHTML+=d.responseText:k.unfetchExternalCSS(a),f-=1,f||k.parseCSS())},d.open("GET",h,!0),d.send()),e},k.unfetchExternalCSS=function(a){var b=!1,c=a.getAttribute("href"),d=a.getAttribute("media"),e=a.nextSibling;return e&&"style"===e.tagName.toLowerCase()&&e.getAttribute("href")===c&&e.getAttribute("media")===d&&"elq-fetched"===e.className&&(d=d||"",e.parentNode.removeChild(e),delete g[c+d],b=!0),b},k.respondToContext=function(){var a=function(){var a=b.lastClientWidth||0,d=b.lastClientHeight||0;(b.clientWidth!==a||b.clientHeight!==d)&&(clearTimeout(c),c=setTimeout(k.respondToContext,e),b.lastClientWidth=b.clientWidth,b.lastClientHeight=b.clientHeight)};return d=b.defaultView.getComputedStyle(b.querySelector("html"),null).getPropertyValue("fontSize"),window.removeEventListener("resize",a),window.removeEventListener("orientationchange",a),window.addEventListener("resize",a),window.addEventListener("orientationchange",a),l()},k.parseCSS=function(){var c,d,e,f=!1,g=b.querySelectorAll("style"),h=g.length,l=[],m=function(b,c,d){return c+"."+a.register(c,d)},n=function(a,b,c,d){return l.push(c+d+c),b+"-=STRING=-"},o=function(){var a=l.shift();return a};for(c=0;h>c;c+=1){for(d=g[c],e=d.innerHTML,e=e.replace(/\s+/g," "),e=e.replace(/(^|\})\s*/g,"$1\n"),e=e.replace(j,n);i.test(e);)f=!0,e=e.replace(i,m);e=e.replace(/-=STRING=-/g,o),d.innerHTML=e}return k.respondToContext(),f},k.mediaToCondition=function(a){for(a="("+a+")",a=a.replace(/\s*,\s*/g,")||("),a=a.replace(/\s*not\s*([^|]+)\s*/g,"!($1)"),a=a.replace(/\s+and\s+/g,"&&"),a=a.replace(/\s*(?:(min|max)-)?(width|height)\s*:\s*(\d+)(px|em|rem)\s*/g,function(a,b,c,d,e){var f,g,h;return f="min"===b?">=":"max"===b?"<=":"==",g="width"===c?"elw":"elh",h=d,"em"===e?g="("+g+"/pxpem)":"rem"===e&&(g="("+g+"/pxprem)"),g+f+h}),a=a.replace(/\s*(?:(min|max)-)?aspect-ratio\s*:\s*([1-9]\d*)\/([1-9]\d*)\s*/g,function(a,b,c,d){var e,f,g;return e="min"===b?">=":"max"===b?"<=":"==",f="(elw/elh)",g="("+c+"/"+d+")",f+e+g});/\(\(([^)]+)\)\)/.test(a);)a=a.replace(/\(\(([^)]+)\)\)/g,"($1)");return a},a.register=function(a,b,c){return a&&b&&(c||(c=b.replace(/^\W*(\w.*\w)\W*$/,function(a,b){return b=b.replace(/\W+/g,"-"),"elq-"+b})),h[a]||(h[a]={}),h[a][b]=new Function("elw","elh","el","pxpem","pxprem","var changed = { added: [], removed: [] },classes = el.className.split(/\\s+/),exists,i,len = classes.length;for (i = 0; i < len; i += 1) {if (classes[i] === '"+c+"') {exists = i + 1;}}if ("+k.mediaToCondition(b)+") {if (!exists) {classes.push('"+c+"');changed.added.push('"+c+"');}} else {if (exists) {classes.splice(exists - 1, 1);changed.removed.push('"+c+"');}}if (changed.added.length || changed.removed.length) {el.className = classes.join(' ');}return changed;")),k.respondToContext(),c},a.unregister=function(a,b){var c=!1;return a&&b?(c=h[a][b]?!0:!1,delete h[a][b]):(c=Object.keys(h).length?!0:!1,h={}),c},a.process=function(a){var c,d;if(a=a||b.querySelectorAll('link[href*=".css"]'),c=a.length,f=c,c)for(d=0;c>d;d+=1)k.fetchExternalCSS(a[d]);else k.parseCSS();return!0},a.respond=l,a.respondAfter=function(a){return e=+a>=0?a:e},a}(window.elq||{},document);
//# sourceMappingURL=elq.min.js.map